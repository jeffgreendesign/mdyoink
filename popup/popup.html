<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=420">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <h1 class="header-title">mdyoink</h1>
    <button class="icon-btn" id="settingsBtn" title="Settings" aria-label="Open settings">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round">
        <path d="M13 8L10.77 6.85 11.54 4.46 9.15 5.23 8 3 6.85 5.23 4.46 4.46 5.23 6.85 3 8 5.23 9.15 4.46 11.54 6.85 10.77 8 13 9.15 10.77 11.54 11.54 10.77 9.15Z"/>
        <circle cx="8" cy="8" r="2.25"/>
      </svg>
    </button>
  </header>

  <!-- Mode Switcher -->
  <div class="mode-switcher" role="radiogroup" aria-label="Output mode">
    <button class="mode-btn active" data-mode="llm" role="radio" aria-checked="true">LLM</button>
    <button class="mode-btn" data-mode="obsidian" role="radio" aria-checked="false">Obsidian</button>
    <button class="mode-btn" data-mode="raw" role="radio" aria-checked="false">Raw</button>
  </div>

  <!-- Extraction Scope Switcher -->
  <div class="scope-switcher" role="radiogroup" aria-label="Extraction scope">
    <button class="scope-btn active" data-scope="article" role="radio" aria-checked="true" title="Auto-extract article content">Article</button>
    <button class="scope-btn" data-scope="fullpage" role="radio" aria-checked="false" title="Extract full page content">Full Page</button>
    <button class="scope-btn" data-scope="selection" role="radio" aria-checked="false" title="Extract selected text only" id="scopeSelectionBtn">Selection</button>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <button class="toolbar-btn" id="stripLinksBtn" title="Strip URLs (saves tokens)">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M6.5 9.5l3-3M9 7l2.5-2.5a2.12 2.12 0 00-3-3L6 4"/>
        <path d="M7 9l-2.5 2.5a2.12 2.12 0 003 3L10 12"/>
      </svg>
      <span class="toolbar-label" id="stripLinksLabel">links off</span>
    </button>
    <button class="toolbar-btn" id="appendBtn" title="Append to clipboard">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
        <line x1="8" y1="4" x2="8" y2="12"/>
        <line x1="4" y1="8" x2="12" y2="8"/>
      </svg>
      <span class="toolbar-label">append</span>
      <span class="badge hidden" id="appendBadge">0</span>
    </button>
    <button class="toolbar-btn" id="pickerBtn" title="Pick an element from the page">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M3 3l4 10 1.5-3.5L12 8z"/>
        <line x1="10" y1="10" x2="14" y2="14"/>
      </svg>
      <span class="toolbar-label">pick</span>
    </button>
    <button class="toolbar-btn" id="selectorBtn" title="Domain CSS selector">
      <span class="selector-icon">&#127919;</span>
      <span class="toolbar-label">selector</span>
    </button>
  </div>

  <!-- Domain Selector Panel (hidden by default) -->
  <div class="selector-panel hidden" id="selectorPanel">
    <div class="selector-domain" id="selectorDomain"></div>
    <div class="selector-row">
      <label for="selectorInput" class="visually-hidden">CSS selector</label>
      <input type="text" class="selector-input" id="selectorInput" placeholder="e.g. article, .docs-content, main">
      <button class="btn-sm" id="selectorTest">Test</button>
      <button class="btn-sm" id="selectorSave">Save</button>
      <button class="btn-sm btn-danger" id="selectorClear">Clear</button>
    </div>
    <div class="selector-status hidden" id="selectorStatus"></div>
  </div>

  <!-- Editor / Preview -->
  <div class="editor-container">
    <textarea class="editor" id="editor" spellcheck="false" placeholder="Extracting content..." aria-label="Markdown preview editor"></textarea>
    <div class="editor-status hidden" id="editorStatus"></div>
  </div>

  <!-- Action Buttons -->
  <div class="actions">
    <button class="btn btn-primary" id="copyBtn">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
        <rect x="5" y="5" width="9" height="9" rx="1.5"/>
        <path d="M11 5V3.5A1.5 1.5 0 009.5 2h-6A1.5 1.5 0 002 3.5v6A1.5 1.5 0 003.5 11H5"/>
      </svg>
      <span id="copyLabel">Copy</span>
    </button>
    <button class="btn btn-secondary" id="downloadBtn">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M8 2v9M4.5 7.5L8 11l3.5-3.5"/>
        <path d="M2 12v1.5A1.5 1.5 0 003.5 15h9a1.5 1.5 0 001.5-1.5V12"/>
      </svg>
      <span>Download</span>
    </button>
  </div>

  <!-- Footer / Token Counter -->
  <footer class="footer" id="footer">
    <div class="token-info">
      <span id="tokenCount">~0 tokens</span>
      <span class="token-separator">&middot;</span>
      <span id="tokenPercent">0% of Claude 200k</span>
    </div>
    <div class="token-bar-container">
      <div class="token-bar" id="tokenBar" style="width: 0%"></div>
    </div>
    <div class="attribution">
      by Jeff Green &middot; v0.1.0
    </div>
  </footer>

  <script src="../lib/turndown.js"></script>
  <script src="../lib/turndown-plugin-gfm.js"></script>
  <script src="popup.js" type="module"></script>
</body>
</html>
